# Troubleshooting 502 Bad Gateway Error
# Run these commands to diagnose the issue

# Step 1: Check if container is running
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker ps | grep rydora"

# Step 2: Check container logs for errors
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker logs --tail 100 rydora"

# Step 3: Check if the app is listening on port 5000 inside container
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker exec rydora netstat -tuln | grep 5000"

# Step 4: Test health endpoint directly (bypass nginx)
ssh orlovus@192.168.1.134 "curl http://localhost:9443/health"

# Step 5: Check container health
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker inspect rydora | grep -A 10 State"

# Step 6: If container is not running, check why it stopped
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker ps -a | grep rydora"

# Step 7: Restart container
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker restart rydora"

# Step 8: If restart doesn't work, check for port conflicts
ssh orlovus@192.168.1.134 "netstat -tuln | grep :9443"

# Step 9: If still failing, recreate container with correct port mapping
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker rm -f rydora && /share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker run -d --name rydora --restart unless-stopped -p 9443:5000 -e NODE_ENV=production -e PORT=5000 -e SESSION_SECRET=your-super-secure-session-secret rydora:latest"

# Step 10: Wait a few seconds then check logs again
ssh orlovus@192.168.1.134 "/share/ZFS530_DATA/.qpkg/container-station/usr/bin/docker logs -f rydora"


